<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Test API</title>
</head>
<body>
  <h1>API Test</h1>

  <button id="login">Login</button>
  <pre id="output"></pre>

  <h2>Shorten URL</h2>
  <input type="text" id="url-input" placeholder="Enter URL">
  <button id="shorten">Shorten</button>

  <h2>Get Stats</h2>
  <input type="text" id="shortcode-input" placeholder="Enter short code">
  <button id="stats">Get Stats</button>

  <script>
    const API_URL = "http://localhost:3000";

    async function api(path, method = "GET", body = null, auth = true) {
      const headers = { "Content-Type": "application/json" };
      if (auth) {
        const token = localStorage.getItem("token");
        if (token) headers["Authorization"] = `Bearer ${token}`;
      }
      const res = await fetch(API_URL + path, {
        method,
        headers,
        body: body ? JSON.stringify(body) : null,
      });
      const text = await res.text();
      try { return JSON.parse(text); } catch { return text; }
    }

    document.getElementById("login").onclick = async () => {
      try {
        const res = await api("/auth/login", "POST", {
          email: "test@example.com",   // change to real user
          password: "password123"
        }, false);
        console.log("Login response:", res); // ðŸ‘ˆ check keys here
        localStorage.setItem("token", res.accessToken);
        document.getElementById("output").innerText = "Logged in!";
      } catch (err) {
        document.getElementById("output").innerText = "Login failed";
      }
    };

    document.getElementById("shorten").onclick = async () => {
      try {
        const url = document.getElementById("url-input").value;
        const res = await api("/url/shorten-user", "POST", { originalUrl: url });
        document.getElementById("output").innerText = JSON.stringify(res, null, 2);
      } catch (err) {
        document.getElementById("output").innerText = "Shorten failed";
      }
    };

    document.getElementById("stats").onclick = async () => {
      try {
        const code = document.getElementById("shortcode-input").value;
        const res = await api(`/url/stats/${code}`, "GET", null, false);
        document.getElementById("output").innerText = JSON.stringify(res, null, 2);
      } catch (err) {
        document.getElementById("output").innerText = "Stats fetch failed";
      }
    };
  </script>
</body>
</html>
